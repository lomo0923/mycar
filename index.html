<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å°ˆæ¥­æ„›è»Šä¿é¤Šç®¡ç†ç³»çµ±</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        body {
            background-color: #f8fafc;
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            padding-top: 70px; 
        }
        .card {
            background: white;
            border-radius: 1rem;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            transition: all 0.2s;
        }
        .fixed-header {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            z-index: 50;
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
            border-bottom: 1px solid #e2e8f0;
        }
        input, select, textarea {
            border-radius: 0.5rem !important;
        }
        .record-card:hover {
            border-color: #3b82f6;
            transform: translateY(-2px);
        }
    </style>
</head>
<body>

    <!-- å›ºå®šå¼å°èˆª -->
    <header class="fixed-header px-6 py-4 flex justify-between items-center">
        <div class="flex items-center space-x-2">
            <i class="fas fa-car-side text-blue-600 text-2xl"></i>
            <h1 class="text-xl font-bold text-gray-800">æ„›è»Šä¿é¤Šç®¡å®¶</h1>
        </div>
        <nav class="hidden md:flex space-x-6 text-sm font-medium text-gray-600">
            <a href="#basic-info" class="hover:text-blue-600 transition">åŸºæœ¬è³‡æ–™</a>
            <a href="#maintenance-form" class="hover:text-blue-600 transition">æ–°å¢ç´€éŒ„</a>
            <a href="#history" class="hover:text-blue-600 transition">æ­·å²ç´€éŒ„</a>
            <a href="#guide" class="hover:text-blue-600 transition">ä¿é¤ŠæŒ‡å—</a>
        </nav>
        <div class="flex items-center space-x-3">
            <button class="bg-blue-600 text-white px-4 py-2 rounded-lg text-sm font-semibold hover:bg-blue-700 transition">
                <i class="fas fa-save mr-2"></i>åŒ¯å‡ºå ±è¡¨
            </button>
        </div>
    </header>

    <main class="max-w-5xl mx-auto p-4 space-y-8">

        <!-- 1. è»Šè¼›åŸºæœ¬è³‡æ–™å¡ç‰‡ -->
        <section id="basic-info" class="card p-6 border-l-4 border-blue-500">
            <div class="flex items-center mb-4">
                <i class="fas fa-id-card text-blue-500 mr-3 text-xl"></i>
                <h2 class="text-lg font-bold text-gray-800">è»Šè¼›åŸºæœ¬è³‡æ–™</h2>
            </div>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                <div>
                    <label class="block text-sm text-gray-500 mb-1">è»Šå‹ / å¹´ä»½</label>
                    <input type="text" class="w-full bg-gray-50 border border-gray-200 p-2 outline-none focus:ring-2 focus:ring-blue-400" placeholder="ä¾‹å¦‚ï¼šToyota RAV4 / 2023">
                </div>
                <div>
                    <label class="block text-sm text-gray-500 mb-1">è»Šç‰Œè™Ÿç¢¼</label>
                    <input type="text" class="w-full bg-gray-50 border border-gray-200 p-2 outline-none" placeholder="ABC-1234">
                </div>
                <div>
                    <label class="block text-sm text-gray-500 mb-1">å¼•æ“/è»Šèº«è™Ÿç¢¼</label>
                    <input type="text" class="w-full bg-gray-50 border border-gray-200 p-2 outline-none" placeholder="ç”¨æ–¼è¨‚è³¼é›¶ä»¶ç¶­ä¿®">
                </div>
            </div>
        </section>

        <!-- 2. æ–°å¢/ç·¨è¼¯ä¿é¤Šç´€éŒ„ -->
        <section id="maintenance-form" class="card p-6">
            <div class="flex items-center mb-6">
                <i class="fas fa-tools text-orange-500 mr-3 text-xl"></i>
                <h2 id="form-title" class="text-lg font-bold text-gray-800">æ–°å¢æœ¬æ¬¡ä¿é¤Šç´€éŒ„</h2>
            </div>
            
            <input type="hidden" id="edit-id" value="">

            <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
                <div class="space-y-4">
                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm text-gray-500 mb-1">ç´€éŒ„æ—¥æœŸ</label>
                            <input type="date" id="m-date" class="w-full bg-gray-50 border border-gray-200 p-2 outline-none">
                        </div>
                        <div>
                            <label class="block text-sm text-gray-500 mb-1">ç›®å‰é‡Œç¨‹ (km)</label>
                            <input type="number" id="m-mileage" oninput="suggestMaintenance()" class="w-full bg-gray-50 border border-gray-200 p-2 outline-none focus:ring-2 focus:ring-orange-400" placeholder="ä¾‹å¦‚ï¼š10000">
                        </div>
                    </div>
                    <div>
                        <label class="block text-sm text-gray-500 mb-1">æ‰¿åšå–®ä½</label>
                        <select id="m-provider" class="w-full bg-gray-50 border border-gray-200 p-2 outline-none">
                            <option value="åŸå» ">åŸå» æˆæ¬Šä¿é¤Šå» </option>
                            <option value="å¤–å» ">ä¸€èˆ¬åŠé–“å¤–å» </option>
                            <option value="DIY">è‡ªè¡Œä¿é¤Š (DIY)</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm text-gray-500 mb-1">ç¸½é‡‘é¡ (å«å·¥è³‡é›¶ä»¶)</label>
                        <div class="relative">
                            <span class="absolute left-3 top-2 text-gray-400">$</span>
                            <input type="number" id="m-cost" class="w-full bg-gray-50 border border-gray-200 p-2 pl-7 outline-none" placeholder="0">
                        </div>
                    </div>
                </div>

                <div class="space-y-4">
                    <div>
                        <label class="block text-sm text-gray-500 mb-1">æ–½ä½œé …ç›®å…§å®¹</label>
                        <textarea id="m-items" rows="3" class="w-full bg-gray-50 border border-gray-200 p-2 outline-none" placeholder="è«‹è¼¸å…¥æ–½ä½œç´°ç¯€..."></textarea>
                        <div id="suggestion-box" class="mt-2 text-xs text-blue-600 bg-blue-50 p-3 rounded-lg hidden border border-blue-100">
                            <div class="flex items-start">
                                <i class="fas fa-lightbulb mt-1 mr-2"></i>
                                <div>
                                    <span class="font-bold">é‡Œç¨‹å»ºè­°ï¼š</span><span id="suggestion-text"></span><br>
                                    <span class="text-gray-500 mt-1 block" id="suggestion-note"></span>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div>
                        <label class="block text-sm text-gray-500 mb-1">å‚™è¨» / ä¸‹æ¬¡é è¨ˆé‡Œç¨‹</label>
                        <input type="text" id="m-next" class="w-full bg-gray-50 border border-gray-200 p-2 outline-none" placeholder="ä¾‹å¦‚ï¼šä¸‹æ¬¡é è¨ˆ 20,000 km">
                    </div>
                </div>
            </div>
            
            <div class="flex space-x-3">
                <button id="save-btn" onclick="saveRecord()" class="flex-1 bg-gray-800 text-white py-3 rounded-xl font-bold hover:bg-black transition-all shadow-lg active:scale-95">
                    å„²å­˜ä¿é¤Šç´€éŒ„
                </button>
                <button id="cancel-edit-btn" onclick="resetForm()" class="hidden bg-gray-200 text-gray-600 px-6 py-3 rounded-xl font-bold hover:bg-gray-300 transition-all">
                    å–æ¶ˆä¿®æ”¹
                </button>
            </div>
        </section>

        <!-- 3. æ­·å²ç´€éŒ„åˆ—è¡¨ -->
        <section id="history" class="space-y-4">
            <h3 class="text-gray-600 font-bold ml-1 flex justify-between items-center">
                <span>æ­·å²ä¿é¤Šç´€éŒ„</span>
                <span class="text-xs font-normal text-gray-400">é»æ“Šç­†åœ–ç¤ºå¯é€²è¡Œç·¨è¼¯</span>
            </h3>
            <div id="record-list" class="space-y-4">
                <!-- å…§å®¹ç”± JavaScript ç”Ÿæˆ -->
            </div>
        </section>

        <!-- 4. æ ¸å¿ƒä¿é¤Šé …ç›®æ¸…å–® -->
        <section id="guide" class="card overflow-hidden">
            <div class="p-6 bg-gray-50 border-b border-gray-200">
                <h2 class="text-lg font-bold text-gray-800">æ ¸å¿ƒä¿é¤Šé …ç›®æŒ‡å—</h2>
                <p class="text-sm text-gray-500">ä¾ç…§ã€Œé‡Œç¨‹ã€æˆ–ã€Œæ™‚é–“ã€é »ç‡åˆ†é¡ä¹‹å»ºè­°æ¸…å–®</p>
            </div>
            <div class="overflow-x-auto">
                <table class="w-full text-left text-sm">
                    <thead class="bg-white border-b">
                        <tr>
                            <th class="px-6 py-4 font-bold text-gray-700">é‡Œç¨‹/æ™‚é–“</th>
                            <th class="px-6 py-4 font-bold text-gray-700">åŸºç¤ä¿é¤Šé …ç›®</th>
                            <th class="px-6 py-4 font-bold text-gray-700">é‡é»æª¢æŸ¥/æ›´æ›</th>
                            <th class="px-6 py-4 font-bold text-gray-700">å‚™è¨»äº‹é …</th>
                        </tr>
                    </thead>
                    <tbody class="divide-y" id="guide-table-body"></tbody>
                </table>
            </div>
        </section>

        <!-- 5. çŸ¥è­˜å°å¡ -->
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <div class="card p-6 bg-gradient-to-br from-blue-50 to-white border border-blue-100">
                <h3 class="font-bold text-blue-800 mb-3"><i class="fas fa-oil-can mr-2"></i>æ©Ÿæ²¹æ¨è–¦èˆ‡é¸ç”¨</h3>
                <p class="text-sm text-gray-700 leading-relaxed">
                    æ¨è–¦é»åº¦ï¼š<strong class="text-blue-600">0W-20</strong> æˆ– <strong class="text-blue-600">5W-30</strong>ã€‚<br>
                    åŸå› ï¼šä½é»åº¦æ©Ÿæ²¹èƒ½æœ‰æ•ˆé™ä½å¼•æ“é‹è½‰é˜»åŠ›ï¼Œç™¼æ® Hybrid/æ¸¦è¼ª ç¯€èƒ½å„ªå‹¢ã€‚
                </p>
            </div>
            <div class="card p-6 bg-gradient-to-br from-gray-50 to-white border border-gray-200">
                <h3 class="font-bold text-gray-800 mb-3"><i class="fas fa-ring mr-2"></i>è¼ªèƒé¤Šè­·å»ºè­°</h3>
                <p class="text-sm text-gray-700 leading-relaxed">
                    å»ºè­°æ¯ <strong class="text-orange-600">10,000 å…¬é‡Œ</strong> é€²è¡Œå°èª¿ã€‚èƒç´‹æ·±åº¦ä½æ–¼ <strong class="text-red-600">1.6mm</strong> å‰‡å¿…é ˆç«‹å³æ›´æ›ã€‚
                </p>
            </div>
        </div>

    </main>

    <footer class="py-12 text-center text-gray-400 text-xs">
        Â© 2024 Professional Car Maintenance System. Keep Driving Safely.
    </footer>

    <script>
        // åˆå§‹åŒ–è³‡æ–™
        let records = [
            { id: Date.now(), date: '2024-12-01', km: 10000, items: 'æ›´æ›æ©Ÿæ²¹ã€æ©Ÿæ²¹èŠ¯ã€è¼ªèƒå°èª¿', cost: 5600, provider: 'åŸå» ', next: 'é è¨ˆ 20,000 km' }
        ];

        const maintenanceLogic = [
            { km: 1000, title: "1,000 km", items: "å…¨è»Šæª¢æŸ¥", core: "è¦–æƒ…æ³æ›´æ›æ©Ÿæ²¹ã€æ©Ÿæ²¹èŠ¯", note: "å…è²»å¥æª¢ï¼Œå»ºç«‹è»Šç±è³‡æ–™" },
            { km: 5000, title: "5,000 km", items: "æ›´æ›æ©Ÿæ²¹", core: "æª¢æŸ¥èƒå£“ã€ç…è»Šã€å†·å»æ°´", note: "è‹¥å…¨é«˜é€Ÿè¡Œé§›å¯å»¶è‡³1è¬" },
            { km: 10000, title: "10,000 km", items: "æ©Ÿæ²¹ã€æ©Ÿæ²¹èŠ¯", core: "è¼ªèƒå°èª¿ã€ç©ºæ°£æ¿¾ç¶²æ¸…æ½”", note: "å»ºè­°æ·»åŠ æ±½æ²¹ç²¾æ¸…æ½”æ²¹è·¯" },
            { km: 20000, title: "20,000 km", items: "æ©Ÿæ²¹ã€æ©Ÿæ²¹èŠ¯", core: "ç©ºæ°£æ¿¾ç¶²ã€å†·æ°£æ¿¾ç¶²æ›´æ›", note: "æª¢æŸ¥ç…è»Šæ²¹å«æ°´é‡" },
            { km: 40000, title: "40,000 km", items: "æ©Ÿæ²¹ã€æ©Ÿæ²¹èŠ¯", core: "è®Šé€Ÿç®±æ²¹ (CVT Fluid)ã€ç…è»Šæ²¹", note: "æ­¤ç‚ºå¤§ä¿é¤Šï¼Œè²»ç”¨è¼ƒé«˜", critical: true },
            { km: 60000, title: "60,000 km", items: "æ©Ÿæ²¹ã€æ©Ÿæ²¹èŠ¯", core: "çš®å¸¶å¼µåŠ›æª¢æŸ¥ã€ç«æ˜Ÿå¡æª¢æŸ¥", note: "è¦–è€—ææƒ…æ³æ›´æ›çš®å¸¶" },
            { km: 100000, title: "100,000 km", items: "æ©Ÿæ²¹ã€æ©Ÿæ²¹èŠ¯", core: "é•·æ•ˆå†·å»æ°´æ›´æ›ã€ç«æ˜Ÿå¡æ›´æ›", note: "å…¨è»Šå¤§é«”æª¢" }
        ];

        // æ¸²æŸ“ä¿é¤ŠæŒ‡å—
        function renderGuide() {
            const tableBody = document.getElementById('guide-table-body');
            tableBody.innerHTML = '';
            maintenanceLogic.forEach(row => {
                const tr = document.createElement('tr');
                tr.className = row.critical ? "bg-red-50 hover:bg-red-100" : "hover:bg-gray-50";
                tr.innerHTML = `
                    <td class="px-6 py-4 font-semibold">${row.title}</td>
                    <td class="px-6 py-4">${row.items}</td>
                    <td class="px-6 py-4">${row.core}</td>
                    <td class="px-6 py-4 text-gray-500">${row.note}</td>
                `;
                tableBody.appendChild(tr);
            });
        }

        // æ¸²æŸ“æ­·å²ç´€éŒ„
        function renderRecords() {
            const recordList = document.getElementById('record-list');
            recordList.innerHTML = '';
            
            // ä¾é‡Œç¨‹é™åºæ’åˆ—
            const sortedRecords = [...records].sort((a, b) => b.km - a.km);

            sortedRecords.forEach(record => {
                const div = document.createElement('div');
                div.className = "card p-5 border-l-4 border-blue-500 record-card";
                div.innerHTML = `
                    <div class="flex justify-between items-start">
                        <div class="flex-1">
                            <span class="text-xs font-bold px-2 py-1 bg-blue-100 text-blue-700 rounded mb-2 inline-block">${parseInt(record.km).toLocaleString()} km ç´€éŒ„</span>
                            <h4 class="font-bold text-gray-800 text-lg">${record.items}</h4>
                            <p class="text-sm text-gray-500 mt-1">
                                <i class="far fa-calendar-alt mr-2"></i>${record.date} | 
                                <i class="fas fa-map-marker-alt mr-2"></i>${record.provider}
                            </p>
                            <p class="text-xs text-gray-400 mt-2 italic">å‚™è¨»: ${record.next || 'ç„¡'}</p>
                        </div>
                        <div class="flex flex-col items-end space-y-4">
                            <div class="text-right">
                                <p class="text-xl font-black text-gray-900">$ ${parseInt(record.cost || 0).toLocaleString()}</p>
                            </div>
                            <div class="flex space-x-2">
                                <button onclick="editRecord(${record.id})" class="p-2 text-blue-500 hover:bg-blue-50 rounded-full transition" title="ä¿®æ”¹å…§å®¹">
                                    <i class="fas fa-pencil-alt"></i>
                                </button>
                                <button onclick="deleteRecord(${record.id})" class="p-2 text-red-400 hover:bg-red-50 rounded-full transition" title="åˆªé™¤ç´€éŒ„">
                                    <i class="fas fa-trash-alt"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                `;
                recordList.appendChild(div);
            });
        }

        // å„²å­˜æˆ–æ›´æ–°ç´€éŒ„
        function saveRecord() {
            const editId = document.getElementById('edit-id').value;
            const recordData = {
                date: document.getElementById('m-date').value,
                km: parseInt(document.getElementById('m-mileage').value),
                items: document.getElementById('m-items').value,
                cost: parseInt(document.getElementById('m-cost').value) || 0,
                provider: document.getElementById('m-provider').value,
                next: document.getElementById('m-next').value
            };

            if (!recordData.date || isNaN(recordData.km) || !recordData.items) {
                alert("è«‹å¡«å¯«åŸºæœ¬æ—¥æœŸã€é‡Œç¨‹èˆ‡æ–½ä½œé …ç›®å…§å®¹ï¼");
                return;
            }

            if (editId) {
                // æ›´æ–°ç¾æœ‰ç´€éŒ„
                const index = records.findIndex(r => r.id == editId);
                if (index !== -1) {
                    records[index] = { ...records[index], ...recordData };
                }
            } else {
                // æ–°å¢ç´€éŒ„
                records.push({ id: Date.now(), ...recordData });
            }

            resetForm();
            renderRecords();
            document.getElementById('history').scrollIntoView({behavior: "smooth"});
        }

        // ç·¨è¼¯åŠŸèƒ½
        function editRecord(id) {
            const record = records.find(r => r.id === id);
            if (!record) return;

            document.getElementById('edit-id').value = record.id;
            document.getElementById('m-date').value = record.date;
            document.getElementById('m-mileage').value = record.km;
            document.getElementById('m-items').value = record.items;
            document.getElementById('m-cost').value = record.cost;
            document.getElementById('m-provider').value = record.provider;
            document.getElementById('m-next').value = record.next;

            // UI æ›´æ–°
            document.getElementById('form-title').innerText = "ä¿®æ”¹ä¿é¤Šç´€éŒ„";
            document.getElementById('save-btn').innerText = "æ›´æ–°ä¿é¤Šç´€éŒ„";
            document.getElementById('cancel-edit-btn').classList.remove('hidden');
            document.getElementById('maintenance-form').scrollIntoView({behavior: "smooth"});
        }

        // åˆªé™¤åŠŸèƒ½
        function deleteRecord(id) {
            if (confirm("ç¢ºå®šè¦åˆªé™¤é€™ç­†ä¿é¤Šç´€éŒ„å—ï¼Ÿæ­¤å‹•ä½œç„¡æ³•å¾©åŸã€‚")) {
                records = records.filter(r => r.id !== id);
                renderRecords();
            }
        }

        // é‡ç½®è¡¨å–®
        function resetForm() {
            document.getElementById('edit-id').value = "";
            document.getElementById('m-date').valueAsDate = new Date();
            document.getElementById('m-mileage').value = "";
            document.getElementById('m-items').value = "";
            document.getElementById('m-cost').value = "";
            document.getElementById('m-next').value = "";
            document.getElementById('form-title').innerText = "æ–°å¢æœ¬æ¬¡ä¿é¤Šç´€éŒ„";
            document.getElementById('save-btn').innerText = "å„²å­˜ä¿é¤Šç´€éŒ„";
            document.getElementById('cancel-edit-btn').classList.add('hidden');
            document.getElementById('suggestion-box').classList.add('hidden');
        }

        // è‡ªå‹•å»ºè­°åŠŸèƒ½é‚è¼¯
        function suggestMaintenance() {
            const mileageInput = document.getElementById('m-mileage').value;
            const mileage = parseInt(mileageInput);
            const suggestionBox = document.getElementById('suggestion-box');
            const suggestionText = document.getElementById('suggestion-text');
            const suggestionNote = document.getElementById('suggestion-note');
            const itemsArea = document.getElementById('m-items');
            const nextInput = document.getElementById('m-next');

            if (!mileageInput || isNaN(mileage)) {
                suggestionBox.classList.add('hidden');
                return;
            }

            const match = maintenanceLogic.reduce((prev, curr) => {
                return (Math.abs(curr.km - mileage) < Math.abs(prev.km - mileage)) ? curr : prev;
            });

            if (Math.abs(match.km - mileage) <= 1500) {
                suggestionBox.classList.remove('hidden');
                suggestionText.innerText = `${match.items} + ${match.core}`;
                suggestionNote.innerText = `ğŸ’¡ è²¼å¿ƒæé†’ï¼š${match.note}`;
                
                if (itemsArea.value === "") {
                    itemsArea.value = `${match.items}ã€${match.core}`;
                }
                const nextKm = match.km + 10000;
                if (nextInput.value === "") {
                    nextInput.value = `é è¨ˆ ${nextKm.toLocaleString()} km ä¿é¤Š`;
                }
            } else {
                suggestionBox.classList.add('hidden');
            }
        }

        // åˆå§‹åŒ–
        window.onload = () => {
            document.getElementById('m-date').valueAsDate = new Date();
            renderGuide();
            renderRecords();
        };
    </script>
</body>
</html>